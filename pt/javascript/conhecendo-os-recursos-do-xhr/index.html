<!DOCTYPE html>
<html lang="pt">

<head>
    <meta charset="utf-8">
    
        <link rel="icon" href="/favicon.png">
    
        <meta name="robots" content="index, follow">
    
        <meta name="author" content="codermarcos">
    
        <meta name="content" content="Um pouco sobre que aprendi ou estou aprendendo sobre frontend e boas praticas.">
    
        <meta name="keywords" content="Frontend-Weekly, FrontendWeekly, Frontend Weekly, Frontend, Weekly, Javascript, HTML, CSS">
    

    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <title>Frontend Weekly | Conhecendo os recursos do xhr</title>
    
    <link rel="stylesheet" href="/css/style.css">
</head>
<body itemscope itemprop="blogPost">
    <nav class="navbar clear">
    <a 
        href="/" 
        class="navbar__title"
        title="Go to home">
        Frontend Weekly</a>
</nav>
<header class="main-header">
    <div class="main-header__background"></div>
    <div class="main-header__container">        
        <h1 class="main-header__title" itemprop="name">
            Conhecendo os recursos do xhr</h1>
        <p class="main-header__container__description">
            <a 
                class="description__category" 
                href="/categories/javascript"
                tilte="Categoria">javascript</a>
            <br>
            <time 
                class="description__day" 
                datetime="2017-11-21" 
                title="Puclicado em 21 nov 2017"
                itemprop="datePublished">21 nov 17 14h 7m</time>        
        </p>
    </div>
</header>
<main class="main-content">
    <div 
        class="main-content__container markdown" 
        itemprop="articleBody">
        <p><strong>Oque é</strong> o XMLHttpRequest ou como é mais conhecido XHR, segundo á <a href="https://developer.mozilla.org/pt-BR/docs/Web/API/XMLHttpRequest" target="_blank" rel="noopener">mdn</a> é uma API que fornece funcionalidade ao cliente para transferir dados entre um cliente e um servidor.</p>
<h3 id="Uso-basico"><a href="#Uso-basico" class="headerlink" title="Uso basico"></a>Uso basico</h3><p>Exemplo de uso com <strong>json</strong><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> xhr = <span class="keyword">new</span> XMLHttpRequest(); <span class="comment">// Instancia o xhr </span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> json = <span class="built_in">JSON</span>.stringify(&#123;</span><br><span class="line">  field: <span class="string">'name'</span>,</span><br><span class="line">  value: <span class="string">'Mike'</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> method = <span class="string">'POST'</span>;</span><br><span class="line"><span class="keyword">const</span> url = <span class="string">'https://jsonplaceholder.typicode.com/posts'</span>;</span><br><span class="line"></span><br><span class="line">xhr.open(method, url); <span class="comment">// Inicializa o xhr com os parametros necessarios</span></span><br><span class="line"></span><br><span class="line">xhr.onload = <span class="function"><span class="params">()</span> =&gt;</span> &#123; </span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'O request terminou'</span>,  <span class="built_in">JSON</span>.parse(xhr.responseText)); <span class="comment">// Evento chamado ao fim do request</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">xhr.send(json);  <span class="comment">// Enviar com os parametros do request</span></span><br></pre></td></tr></table></figure></p>
<p>Exemplo de uso com <strong>form</strong><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> xhr = <span class="keyword">new</span> XMLHttpRequest(); <span class="comment">// Instancia o xhr</span></span><br><span class="line"><span class="keyword">let</span> form  = <span class="keyword">new</span> FormData(); <span class="comment">// Instancia do Form para adicionar seus campos</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> field = <span class="string">'name'</span>;</span><br><span class="line"><span class="keyword">let</span> value = <span class="string">'Mike'</span>;</span><br><span class="line"></span><br><span class="line">form.append(field, value); <span class="comment">// adiocinando ao form </span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> method = <span class="string">'POST'</span>;</span><br><span class="line"><span class="keyword">const</span> url = <span class="string">'https://jsonplaceholder.typicode.com/posts'</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">xhr.open(method, url); <span class="comment">// Inicializa o request mudando seu status para 1</span></span><br><span class="line"></span><br><span class="line">xhr.onload = <span class="function"><span class="params">()</span> =&gt;</span> &#123; </span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'O request terminou'</span>,  <span class="built_in">JSON</span>.parse(xhr.responseText)); <span class="comment">// status termina com status 4</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">xhr.send(form);  <span class="comment">// envia seu request</span></span><br></pre></td></tr></table></figure></p>
<h3 id="State"><a href="#State" class="headerlink" title="State"></a>State</h3><p><a href="https://xhr.spec.whatwg.org/#states" target="_blank" rel="noopener">states</a> é oque identifica o estado atual do xhr que pode ser 0, 1, 2, 3, 4.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">0 = UNSENT, Foi instanciado mas ainda não foi iniciado. O metodo open() não foi chamado;</span><br><span class="line">1 = OPENED, Apos a chamada do metodo open();</span><br><span class="line">2 = HEADERS_RECEIVED, Recebeu os headers, só chama o metodo [onreadystatechange]() quando é setado algum header</span><br><span class="line">3 = LOADING, Recebeu ou esta recebendo o response</span><br><span class="line">4 = DONE, O Request finalizou</span><br><span class="line">``` </span><br><span class="line">[readyState](https://xhr.spec.whatwg.org/#dom-xmlhttprequest-readystate) é um atributo do objeto xhr que contem o state atual do xhr. </span><br><span class="line"></span><br><span class="line">[onreadystatechange](https://xhr.spec.whatwg.org/#event-xhr-readystatechange) Metodo usado para acompanhar o status do request.</span><br><span class="line"></span><br><span class="line">```javascript</span><br><span class="line">  xhr.onreadystatechange = () =&gt; &#123; </span><br><span class="line">	  if(xhr.readyState !== XMLHttpRequest.DONE) return;</span><br><span class="line">    // request terminou</span><br><span class="line">  &#125;;</span><br></pre></td></tr></table></figure>
<h3 id="Adicionando-um-header"><a href="#Adicionando-um-header" class="headerlink" title="Adicionando um header"></a>Adicionando um header</h3><p><a href="https://xhr.spec.whatwg.org/#dom-xmlhttprequest-setrequestheader" target="_blank" rel="noopener">setRequestHeader</a> Prototype utilizado para adicionar os headers do request.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> xhr = <span class="keyword">new</span> XMLHttpRequest(); <span class="comment">// Instancia o xhr</span></span><br><span class="line">xhr.setRequestHeader(<span class="string">'Content-Type'</span>, <span class="string">'application/json'</span>);</span><br></pre></td></tr></table></figure>
<h3 id="Abort"><a href="#Abort" class="headerlink" title="Abort"></a>Abort</h3><p><a href="https://xhr.spec.whatwg.org/#dom-xmlhttprequest-abort" target="_blank" rel="noopener">abort</a> Metodo do xhr utilizado para cancelar o request.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">xhr.onabort = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'O request foi cancelado'</span>); <span class="comment">// Evento chamado quando request é cancelado</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">xhr.abort(); <span class="comment">// Cancela seu request</span></span><br></pre></td></tr></table></figure>
<h3 id="Progress"><a href="#Progress" class="headerlink" title="Progress"></a>Progress</h3><p><a href="https://xhr.spec.whatwg.org/#event-xhr-loadstart" target="_blank" rel="noopener">loadstart</a> Metodo do xhr utilizado para acompanhar o INICIO do request.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">xhr.onloadstart = <span class="function">(<span class="params">e</span>) =&gt;</span> &#123; </span><br><span class="line">  	<span class="built_in">console</span>.log(e.loaded); <span class="comment">// Evento chamado ao fim do request</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p><a href="https://xhr.spec.whatwg.org/#event-xhr-progress" target="_blank" rel="noopener">progress</a> Metodo do xhr utilizado para acompanhar o ANDAMENTO do request.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">xhr.onprogress = <span class="function">(<span class="params">p</span>) =&gt;</span> &#123; </span><br><span class="line"> <span class="keyword">if</span>(p.lengthComputable) &#123;</span><br><span class="line">  	<span class="built_in">console</span>.log(p.total); <span class="comment">// Total de progresso</span></span><br><span class="line">  	<span class="built_in">console</span>.log(p.loaded); <span class="comment">// Total ja percorrido</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p><a href="https://xhr.spec.whatwg.org/#event-xhr-loadend" target="_blank" rel="noopener">loadend</a> Metodo do xhr utilizado para acompanhar o FIM do request.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">xhr.loadend = <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(e.loaded); <span class="comment">// Request terminou e ja retornou seu response</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

            

        <h5 class="divisor">Tags</h5>
        <section class="tags">
            <div class="tags__container">
             
                <a 
                    class="tags__tag" 
                    href="/tags/javascript"
                    tilte="Tag">Javascript</a>         
             
                <a 
                    class="tags__tag" 
                    href="/tags/comparadores"
                    tilte="Tag">Comparadores</a>         
            
            </div>
        </section>

    
</main>
    <script src="/scripts/script.js"></script>
    
</body>
</html>